services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2019-latest
    environment:
      SA_PASSWORD: "yourStrong(!)Password"
      ACCEPT_EULA: "Y"
      MSSQL_PID: "Developer"
    networks:
      - sqlserver_networks
    # healthcheck:
    #   test: /opt/mssql-tools/bin/sqlcmd -U sa -P "yourStrong(!)Password" -Q "SELECT 1" || exit 1
    #   interval: 3s
    #   timeout: 10s
    #   retries: 10
    #   start_period: 15s
    ports:
      - "1433:1433"
  mssqltools:
    image: mcr.microsoft.com/mssql-tools
    depends_on:
      - sqlserver
    networks:
      - sqlserver_networks
    volumes:
      - ./scripts/migrations.sql:/tmp/migrations.sql
    command: 
      - /bin/bash && /opt/mssql-tools/bin/sqlcmd -S sqlserver -U sa -P yourStrong(!)Password -d master -i ./tmp/migrations.sql
  
networks:
    sqlserver_networks:
      driver: bridge